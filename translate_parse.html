<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <title>DeutscheTag | Translate & Parse</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700&family=Playfair+Display:wght@500;600&display=swap');

        :root {
            --bg: linear-gradient(135deg, #f7f4ff 0%, #f9f6ef 45%, #eef5ff 100%);
            --card: #ffffff;
            --ink: #0f172a;
            --muted: #64748b;
            --accent: #6d4bff;
            --accent-2: #2b72ff;
            --soft: rgba(109, 75, 255, 0.12);
            --shadow: 0 18px 45px rgba(15, 23, 42, 0.12);
            --soft-shadow: 0 12px 24px rgba(15, 23, 42, 0.08);
            --radius-lg: 26px;
            --radius-md: 18px;
            --nav-bg: rgba(255, 255, 255, 0.82);
            --border: rgba(148, 163, 184, 0.2);
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        body.theme-dark {
            --bg: linear-gradient(135deg, #0b1120 0%, #0f172a 45%, #111827 100%);
            --card: #101827;
            --ink: #e2e8f0;
            --muted: #94a3b8;
            --accent: #8b5cf6;
            --accent-2: #38bdf8;
            --soft: rgba(139, 92, 246, 0.18);
            --shadow: 0 18px 45px rgba(0, 0, 0, 0.45);
            --soft-shadow: 0 12px 24px rgba(0, 0, 0, 0.35);
            --nav-bg: rgba(15, 23, 42, 0.82);
            --border: rgba(148, 163, 184, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            min-height: 100vh;
            background: var(--bg);
            font-family: 'Manrope', 'Segoe UI', sans-serif;
            color: var(--ink);
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at 20% 20%, rgba(109, 75, 255, 0.18), transparent 55%),
                        radial-gradient(circle at 80% 10%, rgba(43, 114, 255, 0.15), transparent 45%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .nav {
            position: relative;
            position: relative;
            background: var(--nav-bg);
            border-radius: var(--radius-lg);
            padding: 12px 18px;
            box-shadow: var(--soft-shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            flex-wrap: wrap;
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
        }

        .brand {
    text-decoration: none;
    color: inherit;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .brand img {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            box-shadow: 0 8px 18px rgba(109, 75, 255, 0.2);
        }

        .brand h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.2rem, 2.4vw, 1.8rem);
        }

                                        
        .nav-links {
            display: none;
            position: absolute;
            right: 16px;
            top: 68px;
            flex-direction: column;
            align-items: stretch;
            background: var(--card);
            padding: 12px;
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: var(--soft-shadow);
            z-index: 35;
            min-width: 180px;
        }

        .nav-links.open { display: flex; }

        .nav-links a {
            text-decoration: none;
            color: var(--muted);
            padding: 8px 12px;
            border-radius: 999px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .nav-links a.active,
        .nav-links a:hover {
            background: var(--soft);
            color: var(--accent);
        }
        .nav-actions {
            margin-right: 68px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
            justify-content: flex-start;
        }

        .theme-select {
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--ink);
            padding: 8px 10px;
            border-radius: 12px;
            font-weight: 600;
        }

        .timer {
            background: var(--card);
            border-radius: 14px;
            padding: 10px 14px;
            display: grid;
            gap: 6px;
            min-width: 220px;
            border: 1px solid var(--border);
        }

        .timer .row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--muted);
        }

        .timer strong { color: var(--ink); }

        .timer button {
            border: none;
            border-radius: 10px;
            padding: 6px 10px;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: white;
            transition: transform 0.2s ease;
        }

        .timer button:hover { animation: bounce 0.6s; }

        .timer .note {
            font-size: 0.8rem;
            color: var(--warning);
            min-height: 18px;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .panel {
            background: var(--card);
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow);
            display: grid;
            gap: 12px;
        }

        .panel h2 { font-size: 1.5rem; }
        .panel p { color: var(--muted); }

        .inputs {
            display: grid;
            gap: 14px;
        }

        .input-card {
            background: var(--card);
            border-radius: var(--radius-md);
            padding: 16px;
            border: 1px solid var(--border);
            display: grid;
            gap: 8px;
        }

        .input-card label { font-weight: 600; }

        textarea, input[type="text"] {
            width: 100%;
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 12px;
            font-family: inherit;
            font-size: 0.95rem;
            background: var(--card);
            color: var(--ink);
        }

        .actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .primary-btn {
            border: none;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: white;
            padding: 12px 20px;
            border-radius: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 22px rgba(109, 75, 255, 0.25);
        }

        .secondary-btn {
            border: none;
            background: rgba(148, 163, 184, 0.18);
            color: var(--ink);
            padding: 12px 18px;
            border-radius: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .results {
            display: grid;
            gap: 16px;
        }

        .result-card {
            background: var(--card);
            border-radius: var(--radius-md);
            padding: 16px;
            border: 1px solid var(--border);
            display: grid;
            gap: 8px;
        }

        .result-card h3 { font-size: 1.1rem; }
        .result-card .item { background: rgba(148, 163, 184, 0.14); padding: 12px; border-radius: 10px; display: grid; gap: 8px; }
        .result-card .item strong { display: block; margin-bottom: 4px; }
        .result-card .item span { color: var(--muted); font-size: 0.9rem; }
        .side-by-side { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .side-by-side div { background: rgba(148, 163, 184, 0.12); padding: 8px 10px; border-radius: 8px; }
        .side-by-side strong { margin-bottom: 6px; }
        .results { display: grid; gap: 16px; }

        @media (max-width: 720px) {
            .side-by-side { grid-template-columns: 1fr; }
        }

        @media (max-width: 820px) {
            .nav { justify-content: center; }
            .timer { width: 100%; }
        }

        @media (max-width: 640px) {
            body { padding: 12px; }
            .nav-actions { width: 100%; justify-content: space-between; }
        }

        /* menu-toggle */
                .menu-toggle span {
            width: 20px;
            height: 2px;
            background: var(--ink);
            border-radius: 999px;
            display: block;
        }

        @media (max-width: 820px) {
            .nav { justify-content: center; }
            .timer { width: 100%; }
        }
    
                .settings-panel {
            position: fixed;
            right: 22px;
            bottom: 88px;
            width: min(320px, 90vw);
            background: var(--card);
            border-radius: 18px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            padding: 14px;
            display: none;
            flex-direction: column;
            gap: 12px;
            z-index: 50;
        }

        .settings-panel.open { display: flex; }

        .settings-panel h4 { font-size: 1rem; }
        .settings-row { display: flex; gap: 8px; flex-wrap: wrap; }
        .settings-row select {
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--ink);
            padding: 8px 10px;
            border-radius: 10px;
            font-weight: 600;
        }
        .settings-note { font-size: 0.85rem; color: var(--muted); }
        .debug-box { background: rgba(148, 163, 184, 0.12); padding: 10px; border-radius: 10px; font-size: 0.85rem; color: var(--muted); }
        .settings-actions { display: flex; gap: 8px; }
        .settings-actions button {
            border: none;
            border-radius: 10px;
            padding: 8px 12px;
            font-weight: 600;
            cursor: pointer;
            background: rgba(148, 163, 184, 0.2);
            color: var(--ink);
        }
    
        .menu-toggle {
            display: inline-flex;
            border: none;
            background: rgba(148, 163, 184, 0.2);
            width: 44px;
            height: 44px;
            border-radius: 12px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            gap: 4px;
            flex-direction: column;
            position: absolute;
            right: 16px;
            top: 16px;
            z-index: 40;
        }

        .menu-toggle span {
            width: 20px;
            height: 2px;
            background: var(--ink);
            border-radius: 999px;
            display: block;
        }

        .nav { position: relative; }

                        .nav-actions { margin-right: 68px; }

        .settings-fab {
            position: fixed;
            right: 22px;
            bottom: 22px;
            width: 52px;
            height: 52px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: white;
            display: grid;
            place-items: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            z-index: 60;
        }

        .settings-panel {
            position: fixed;
            right: 22px;
            bottom: 88px;
            width: min(320px, 90vw);
            background: var(--card);
            border-radius: 18px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            padding: 14px;
            display: none;
            flex-direction: column;
            gap: 12px;
            z-index: 60;
        }

        .settings-panel.open { display: flex; }

        .settings-panel h4 { font-size: 1rem; }
        .settings-row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
        .settings-row select {
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--ink);
            padding: 8px 10px;
            border-radius: 10px;
            font-weight: 600;
        }
        .settings-note { font-size: 0.85rem; color: var(--muted); }
        .debug-box { background: rgba(148, 163, 184, 0.12); padding: 10px; border-radius: 10px; font-size: 0.85rem; color: var(--muted); }
        .settings-actions { display: flex; gap: 8px; }
        .settings-actions button {
            border: none;
            border-radius: 10px;
            padding: 8px 12px;
            font-weight: 600;
            cursor: pointer;
            background: rgba(148, 163, 184, 0.2);
            color: var(--ink);
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <a class="brand" href="index.html">
                <img src="apple-touch-icon.png" alt="DeutscheTag logo">
                <div>
                    <h1>DeutscheTag</h1>
                    <div style="color: var(--muted); font-size: 0.9rem;">Translate & parse</div>
                </div>
            </a>
            <button class="menu-toggle" id="menuToggle" aria-label="Open navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="german_matching_game.html">Vocabulary</a>
                <a href="german_grammar_game.html">Sentence Match</a>
                <a href="typing_practice.html">Typing</a>
                <a href="dictionary.html">Dictionary</a>
                <a href="fundamentals.html">Time & Alphabet</a>
                <a href="number_time_match.html">Number/Time Match</a>
                <a href="grammar_guide.html">Grammar Guide</a>
                <a href="verb_forms.html">Verb Forms</a>
                <a href="article_prefix_practice.html">Articles</a>
                <a href="falling_match.html">Falling Match</a>
                <a href="german_2048.html">2048</a>
                <a class="active" href="translate_parse.html">Translate</a>
            </div>
            <div class="nav-actions">
                <div class="timer" id="timerWidget">
                    <div class="row"><span>Session</span><strong id="sessionTime">00:00</strong></div>
                    <div class="row"><span>Today</span><strong id="todayTime">00:00</strong></div>
                    <div class="row"><span>Streak</span><strong id="streakCount">0 days</strong></div>
                    <div class="note" id="timerNote"></div>
                    <button id="timerToggle">Start</button>
                </div>
            </div>
        </nav>

        <section class="panel">
            <h2>Translate and parse German</h2>
            <p>Paste words, sentences, or paragraphs. We return a German-order English gloss plus a full English translation.</p>
        </section>

        <section class="inputs">
            <div class="input-card">
                <label for="sourceInput">Paste German text</label>
                <textarea id="sourceInput" rows="6" placeholder="Paste words, sentences, or a full paragraph here..."></textarea>
                <div class="actions">
                    <button class="primary-btn" id="translateBtn">Translate & Parse</button>
                    <button class="secondary-btn" id="clearBtn">Clear</button>
                    <span id="status" style="color: var(--muted);"></span>
                </div>
            </div>
        </section>

        <section class="results">
            <div class="result-card">
                <h3>Words parsed</h3>
                <div id="wordsResult"></div>
            </div>
            <div class="result-card">
                <h3>Sentences parsed</h3>
                <div id="sentencesResult"></div>
            </div>
            <div class="result-card">
                <h3>Paragraph parsed</h3>
                <div id="paragraphResult"></div>
            </div>
        </section>
    </div>

    <script>


const statusEl = document.getElementById('status');
        const wordsResult = document.getElementById('wordsResult');
        const sentencesResult = document.getElementById('sentencesResult');
        const paragraphResult = document.getElementById('paragraphResult');
        const DEEPL_KEY = '1b7d9e67-ba29-49f0-9677-0d82641a8ad0:fx';
        const DEEPL_RELAY = 'https://comfy-concha-fb9a0f.netlify.app/.netlify/functions/translate';

        const allWords = [['der', 'the (masculine)'], ['die', 'the (feminine/plural)'], ['das', 'the (neuter)'], ['und', 'and'], ['in', 'in'], ['sein', 'to be / his'], ['ein', 'a/an'], ['zu', 'to'], ['haben', 'to have'], ['ich', 'I'], ['werden', 'to become'], ['sie', 'she/they'], ['von', 'from/of'], ['nicht', 'not'], ['mit', 'with'], ['es', 'it'], ['sich', 'oneself'], ['auch', 'also'], ['auf', 'on'], ['für', 'for'], ['an', 'at/on'], ['er', 'he'], ['so', 'so'], ['dass', 'that'], ['können', 'can'], ['dies', 'this'], ['als', 'as/when'], ['ihr', 'you(pl)/her'], ['ja', 'yes'], ['wie', 'how'], ['bei', 'at/with'], ['oder', 'or'], ['wir', 'we'], ['aber', 'but'], ['dann', 'then'], ['man', 'one/you'], ['da', 'there/since'], ['noch', 'still/yet'], ['nach', 'after/to'], ['was', 'what'], ['also', 'so/thus'], ['aus', 'out/from'], ['alle', 'all'], ['wenn', 'if/when'], ['nur', 'only'], ['müssen', 'must'], ['sagen', 'to say'], ['um', 'around/at'], ['über', 'over/about'], ['machen', 'to make/do'], ['kein', 'no/none'], ['Jahr', 'year'], ['du', 'you(singular)'], ['mein', 'my'], ['schon', 'already'], ['vor', 'before/in front'], ['durch', 'through'], ['geben', 'to give'], ['mehr', 'more'], ['andere', 'other'], ['viel', 'much/many'], ['kommen', 'to come'], ['jetzt', 'now'], ['sollen', 'should'], ['mir', 'me/to me'], ['wollen', 'to want'], ['ganz', 'whole/quite'], ['mich', 'me'], ['immer', 'always'], ['gehen', 'to go'], ['sehr', 'very'], ['hier', 'here'], ['doch', 'but/however'], ['bis', 'until'], ['groß', 'big/tall'], ['wieder', 'again'], ['Mal', 'time'], ['zwei', 'two'], ['gut', 'good'], ['wissen', 'to know'], ['neu', 'new'], ['sehen', 'to see'], ['lassen', 'to let'], ['uns', 'us'], ['weil', 'because'], ['unter', 'under'], ['denn', 'because'], ['stehen', 'to stand'], ['jede', 'every'], ['Beispiel', 'example'], ['Zeit', 'time'], ['erste', 'first'], ['ihm', 'him/to him'], ['ihn', 'him'], ['wo', 'where'], ['lang', 'long'], ['eigentlich', 'actually'], ['damit', 'with it/so that'], ['selbst', 'self/even'], ['unser', 'our'], ['oben', 'above'], ['Mann', 'man'], ['solch', 'such'], ['dürfen', 'may/to be allowed'], ['sollte', 'should'], ['konnte', 'could'], ['beim', 'at the'], ['weit', 'far'], ['Leben', 'life'], ['zurück', 'back'], ['jedoch', 'however'], ['etwas', 'something'], ['ohne', 'without'], ['heute', 'today'], ['gegen', 'against'], ['gleich', 'same/right away'], ['einfach', 'simple'], ['neben', 'next to'], ['Tag', 'day'], ['während', 'during/while'], ['finden', 'to find'], ['nichts', 'nothing'], ['bleiben', 'to stay'], ['sondern', 'but rather'], ['natürlich', 'naturally'], ['zwischen', 'between'], ['zusammen', 'together'], ['Frau', 'woman/wife'], ['letzt', 'last'], ['nein', 'no'], ['dazu', 'to it/for that'], ['eben', 'just/exactly'], ['Hand', 'hand'], ['fragen', 'to ask'], ['zeigen', 'to show'], ['zwar', 'indeed/to be sure'], ['Herr', 'Mr./gentleman'], ['Teil', 'part'], ['nächste', 'next'], ['sicherlich', 'certainly'], ['gering', 'small/minor'], ['Kind', 'child'], ['dabei', 'in doing so'], ['allein', 'alone'], ['innerhalb', 'within'], ['halten', 'to hold/stop'], ['alt', 'old'], ['nennen', 'to call/name'], ['sicher', 'sure/safe'], ['Weg', 'way/path'], ['nie', 'never'], ['Welt', 'world'], ['Ende', 'end'], ['Sache', 'thing/matter'], ['Haus', 'house'], ['gerade', 'just/straight'], ['weiter', 'further'], ['soweit', 'as far as'], ['Auge', 'eye'], ['liegen', 'to lie/be located'], ['Frage', 'question'], ['kennen', 'to know (people)'], ['Arbeit', 'work'], ['heißen', 'to be called'], ['Wasser', 'water'], ['gar', 'quite/at all'], ['nah', 'near'], ['wirklich', 'really'], ['denken', 'to think'], ['Platz', 'place/square'], ['vielleicht', 'maybe'], ['Grund', 'reason/ground'], ['Art', 'type/kind'], ['darauf', 'on it/thereupon'], ['los', 'loose/off'], ['davon', 'of it/from it'], ['Menschen', 'people/humans'], ['Staat', 'state'], ['mögen', 'to like'], ['Land', 'country/land'], ['stellen', 'to place/put'], ['junger', 'young'], ['führen', 'to lead'], ['ob', 'whether'], ['Ort', 'place/location'], ['setzen', 'to set/sit'], ['Geld', 'money'], ['recht', 'right/quite'], ['drei', 'three'], ['hoch', 'high'], ['bestehen', 'to exist/pass'], ['Stadt', 'city'], ['verschieden', 'different'], ['Seite', 'side/page'], ['seitdem', 'since then'], ['bringen', 'to bring'], ['Wort', 'word'], ['Zahl', 'number'], ['nehmen', 'to take'], ['sprechen', 'to speak'], ['kam', 'came'], ['Bild', 'picture/image'], ['völlig', 'completely'], ['darin', 'in it'], ['Name', 'name'], ['möglich', 'possible'], ['tun', 'to do'], ['einige', 'some'], ['deshalb', 'therefore'], ['Prozent', 'percent'], ['eher', 'rather/sooner'], ['glauben', 'to believe'], ['zuerst', 'first/at first'], ['Buch', 'book'], ['Gesicht', 'face'], ['je', 'ever/each'], ['Meter', 'meter'], ['etwa', 'about/approximately'], ['wahr', 'true'], ['Weise', 'way/manner'], ['spät', 'late'], ['oft', 'often'], ['daher', 'therefore'], ['dennoch', 'nevertheless'], ['inzwischen', 'meanwhile'], ['fast', 'almost'], ['Kopf', 'head'], ['beide', 'both'], ['spielen', 'to play'], ['nachdem', 'after'], ['verstehen', 'to understand'], ['gegenüber', 'opposite/toward'], ['Musik', 'music'], ['vier', 'four'], ['Uhr', 'clock/hour'], ['höher', 'higher'], ['Stelle', 'position/place'], ['erreichen', 'to reach'], ['Geschichte', 'story/history'], ['warum', 'why'], ['plötzlich', 'suddenly'], ['laufen', 'to run/walk'], ['beginnen', 'to begin'], ['lieber', 'rather/preferably'], ['Raum', 'room/space'], ['gelten', 'to be valid'], ['zugleich', 'at the same time'], ['aufgrund', 'due to'], ['Mutter', 'mother'], ['entgegen', 'toward/contrary'], ['vergehen', 'to pass (time)'], ['Farbe', 'color'], ['klein', 'small'], ['Tür', 'door'], ['schließen', 'to close'], ['Minute', 'minute'], ['Vater', 'father'], ['legen', 'to lay/put'], ['ziehen', 'to pull/move'], ['brauchen', 'to need'], ['arbeiten', 'to work'], ['ergeben', 'to result in'], ['bilden', 'to form'], ['bereit', 'ready'], ['bestimmt', 'certain/definitely'], ['hinter', 'behind'], ['erhalten', 'to receive'], ['Mensch', 'human/person'], ['bedeuten', 'to mean'], ['scheinen', 'to shine/seem'], ['Zimmer', 'room'], ['meist', 'mostly'], ['Straße', 'street'], ['einzig', 'only/single'], ['Kraft', 'power/strength'], ['außer', 'except'], ['folgen', 'to follow'], ['enthalten', 'to contain'], ['schwer', 'heavy/difficult'], ['schließlich', 'finally'], ['falls', 'if/in case'], ['Nacht', 'night'], ['lernen', 'to learn'], ['wirken', 'to have an effect'], ['Ton', 'sound/tone'], ['zumindest', 'at least'], ['erscheinen', 'to appear'], ['würde', 'would'], ['weder', 'neither'], ['Sohn', 'son'], ['laut', 'loud/according to'], ['Fall', 'case/fall'], ['direkt', 'direct'], ['weg', 'away'], ['vergangen', 'past'], ['Monat', 'month'], ['bevor', 'before'], ['Woche', 'week'], ['tragen', 'to carry/wear'], ['gelingen', 'to succeed'], ['Fest', 'festival/firm'], ['Wesen', 'being/essence'], ['Richtung', 'direction'], ['Stimme', 'voice'], ['Luft', 'air'], ['früh', 'early'], ['warten', 'to wait'], ['rund', 'round'], ['Angst', 'fear'], ['gehören', 'to belong'], ['Tochter', 'daughter'], ['insbesondere', 'especially'], ['Gefühl', 'feeling'], ['Feld', 'field'], ['wenig', 'little/few'], ['Form', 'form/shape'], ['nämlich', 'namely'], ['entlang', 'along'], ['wünschen', 'to wish'], ['Entwicklung', 'development'], ['bieten', 'to offer'], ['treffen', 'to meet'], ['danach', 'after that'], ['zunächst', 'first/initially'], ['Natur', 'nature'], ['zuvor', 'before/previously'], ['bald', 'soon'], ['verlieren', 'to lose'], ['Sprache', 'language'], ['Ordnung', 'order'], ['Bereich', 'area/field'], ['Reihe', 'row/series'], ['damals', 'back then'], ['hinaus', 'out/beyond'], ['bereits', 'already'], ['betreffen', 'to concern'], ['mal', 'times/once'], ['fehlen', 'to be missing'], ['gewinnen', 'to win'], ['Krieg', 'war'], ['Boden', 'floor/ground'], ['Lage', 'situation/position'], ['schaffen', 'to create/manage'], ['ansehen', 'to look at'], ['erkennen', 'to recognize'], ['Problem', 'problem'], ['umso', 'all the more'], ['holen', 'to fetch/get'], ['sogar', 'even'], ['darum', 'therefore/about it'], ['kürzlich', 'recently'], ['Mittel', 'means/medium'], ['weiteren', 'further'], ['anfangen', 'to begin'], ['entsprechen', 'to correspond'], ['geschehen', 'to happen'], ['Gesellschaft', 'society'], ['Punkt', 'point/dot'], ['entstehen', 'to arise'], ['behalten', 'to keep'], ['einzeln', 'individual/single'], ['Interesse', 'interest'], ['Möglichkeit', 'possibility'], ['entwickeln', 'to develop'], ['ebenso', 'just as'], ['dunkel', 'dark'], ['aussehen', 'to look like'], ['Liebe', 'love'], ['Morgen', 'morning'], ['lesen', 'to read'], ['fühlen', 'to feel'], ['Gruppe', 'group'], ['suchen', 'to search'], ['allgemein', 'general'], ['erklären', 'to explain'], ['Ding', 'thing'], ['Gegenteil', 'opposite'], ['erzählen', 'to tell'], ['darstellen', 'to represent'], ['eigen', 'own'], ['halt', 'stop/just'], ['lediglich', 'merely'], ['Meinung', 'opinion'], ['Abend', 'evening'], ['Thema', 'topic/theme'], ['Rahmen', 'frame'], ['reden', 'to talk'], ['Schule', 'school'], ['Aufgabe', 'task'], ['Herz', 'heart'], ['Beruf', 'profession'], ['erwarten', 'to expect'], ['Gesetz', 'law'], ['wohnen', 'to live/reside'], ['interessieren', 'to interest'], ['richtig', 'correct'], ['Blick', 'glance/view'], ['Familie', 'family'], ['danken', 'to thank'], ['Freund', 'friend'], ['Ausland', 'foreign country'], ['Auto', 'car'], ['erinnern', 'to remember'], ['Rolle', 'role'], ['Gegenwart', 'present'], ['Stunde', 'hour'], ['öffnen', 'to open'], ['dafür', 'for it'], ['ungefähr', 'approximately'], ['sofort', 'immediately'], ['Markt', 'market'], ['Tisch', 'table'], ['Unterschied', 'difference'], ['Sinn', 'sense/meaning'], ['Stück', 'piece'], ['drehen', 'to turn'], ['glücklich', 'happy'], ['Preis', 'price/prize'], ['stark', 'strong'], ['Schwester', 'sister'], ['Bruder', 'brother'], ['ruhig', 'quiet/calm'], ['studieren', 'to study'], ['Regel', 'rule'], ['verbinden', 'to connect'], ['klar', 'clear'], ['Licht', 'light'], ['Hilfe', 'help'], ['offenbar', 'obviously'], ['hell', 'bright'], ['versuchen', 'to try'], ['Wohnung', 'apartment'], ['gewiss', 'certain'], ['gebrauchen', 'to use'], ['Recht', 'right/law'], ['anbieten', 'to offer'], ['Ziel', 'goal/destination'], ['Satz', 'sentence'], ['Leute', 'people'], ['teilen', 'to share/divide'], ['schreiben', 'to write'], ['Erfolg', 'success'], ['Spiel', 'game'], ['beziehen', 'to refer to'], ['verwenden', 'to use'], ['bewegen', 'to move'], ['hingegen', 'on the other hand'], ['Gedanke', 'thought'], ['wechseln', 'to change'], ['Bett', 'bed'], ['leicht', 'light/easy'], ['Gang', 'hallway/gear'], ['Verhältnis', 'relationship/ratio'], ['trinken', 'to drink'], ['Zukunft', 'future'], ['Bewegung', 'movement'], ['anschauen', 'to look at'], ['Grad', 'degree'], ['überhaupt', 'at all'], ['fallen', 'to fall'], ['erfahren', 'to experience'], ['Ansicht', 'view/opinion'], ['Kampf', 'fight/struggle'], ['Mund', 'mouth'], ['klingen', 'to sound'], ['vergleichen', 'to compare'], ['verändern', 'to change'], ['Idee', 'idea'], ['verlassen', 'to leave'], ['benutzen', 'to use'], ['steigen', 'to climb/rise'], ['hinten', 'back/behind'], ['wachsen', 'to grow'], ['Aufmerksamkeit', 'attention'], ['schweigen', 'to be silent'], ['wählen', 'to choose/vote'], ['längst', 'long ago'], ['nötig', 'necessary'], ['Körper', 'body'], ['handeln', 'to act/deal'], ['helfen', 'to help'], ['kurz', 'short'], ['vorstellen', 'to introduce/imagine']];
        const topWords = new Set(allWords.map((pair) => pair[0].toLowerCase()));
        const missedStorageKey = 'dt-vocab-missed';

        const cacheKey = 'dt-translate-cache';

        function saveCache(payload) {
            localStorage.setItem(cacheKey, JSON.stringify({
                ...payload,
                savedAt: new Date().toISOString()
            }));
        }

        function loadCache() {
            const raw = localStorage.getItem(cacheKey);
            if (!raw) return null;
            try { return JSON.parse(raw); } catch { return null; }
        }

        function setStatus(text, isError = false) {
            statusEl.textContent = text;
            statusEl.style.color = isError ? 'var(--danger)' : 'var(--muted)';
        }

        async function callDeepL(texts, key) {
            const params = new URLSearchParams();
            texts.forEach((t) => params.append('text', t));
            params.append('target_lang', 'EN');
            params.append('source_lang', 'DE');
            params.append('auth_key', key);

            const useRelay = true;
            if (useRelay) {
                let res;
                try {
                    res = await fetch(DEEPL_RELAY, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text: texts, source_lang: 'DE', target_lang: 'EN' })
                    });
                } catch (err) {
                    throw new Error('Relay request failed (network).');
                }
                if (!res.ok) {
                    const message = await res.text();
                    throw new Error(message || `Relay request failed (${res.status}).`);
                }
                const data = await res.json();
                return data.translations.map((t) => t.text);
            }

            const res = await fetch('https://api-free.deepl.com/v2/translate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: params.toString()
            });
            if (!res.ok) {
                const message = await res.text();
                throw new Error(message || 'DeepL request failed.');
            }
            const data = await res.json();
            return data.translations.map((t) => t.text);
        }

        function splitWords(text) {
            return text
                .split(/[\\n,;]+/)
                .map((w) => w.trim())
                .filter(Boolean);
        }

        function splitSentences(text) {
            return text
                .split(/(?<=[.!?])\\s+/)
                .map((s) => s.trim())
                .filter(Boolean);
        }

        function tokenize(sentence) {
            return sentence.split(/\\s+/).filter(Boolean);
        }

        function stripPunct(token) {
            const match = token.match(/^([\\p{L}äöüßÄÖÜ-]+)([.,!?;:]*)$/u);
            if (!match) return { base: token, punct: '' };
            return { base: match[1], punct: match[2] };
        }

        async function germanOrderGloss(sentence, key) {
            const tokens = tokenize(sentence);
            const bases = tokens.map((t) => stripPunct(t).base).filter((b) => b);
            if (!bases.length) return sentence;
            const translations = await callDeepL(bases, key);
            let idx = 0;
            return tokens.map((t) => {
                const { base, punct } = stripPunct(t);
                if (!base) return t;
                const translated = translations[idx++] || base;
                return translated + punct;
            }).join(' ');
        }

        function addToMissed(words) {
            const existing = new Set(JSON.parse(localStorage.getItem(missedStorageKey) || '[]'));
            words.forEach((w) => {
                const word = w.toLowerCase();
                if (topWords.has(word)) existing.add(word);
            });
            localStorage.setItem(missedStorageKey, JSON.stringify([...existing]));
        }

        function renderItems(container, items) {
            container.innerHTML = '';
            if (!items.length) {
                container.innerHTML = '<div class="item">No data yet.</div>';
                return;
            }
            items.forEach((item) => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `<strong>${item.de}</strong><div class="side-by-side"><div><strong>German-order</strong><span>${item.gloss}</span></div><div><strong>English</strong><span>${item.en}</span></div></div>`;
                container.appendChild(div);
            });
        }

        async function handleTranslate() {
            const sourceInput = document.getElementById('sourceInput').value.trim();
            if (!sourceInput) {
                setStatus('Paste some German text first.', true);
                return;
            }
            const cached = loadCache();
            if (cached && cached.input === sourceInput) {
                renderItems(wordsResult, cached.words || []);
                renderItems(sentencesResult, cached.sentences || []);
                renderItems(paragraphResult, cached.paragraphs || []);
                setStatus('Loaded cached translation.');
                return;
            }
            setStatus('Translating...');

            try {
                const wordList = splitWords(sourceInput);
                const sentenceList = splitSentences(sourceInput);
                const paragraphList = sourceInput ? [sourceInput] : [];

                const wordTranslations = wordList.length ? await callDeepL(wordList, DEEPL_KEY) : [];
                const sentenceTranslations = sentenceList.length ? await callDeepL(sentenceList, DEEPL_KEY) : [];
                const paragraphTranslations = paragraphList.length ? await callDeepL(paragraphList, DEEPL_KEY) : [];

                const wordGlosses = wordList.length ? await callDeepL(wordList, DEEPL_KEY) : [];
                const sentenceGlosses = [];
                for (const sentence of sentenceList) {
                    sentenceGlosses.push(await germanOrderGloss(sentence, DEEPL_KEY));
                }
                const paragraphGlosses = [];
                for (const para of paragraphList) {
                    paragraphGlosses.push(await germanOrderGloss(para, DEEPL_KEY));
                }

                const words = wordList.map((de, idx) => ({
                    de,
                    gloss: wordGlosses[idx] || '',
                    en: wordTranslations[idx] || ''
                }));

                const sentences = sentenceList.map((de, idx) => ({
                    de,
                    gloss: sentenceGlosses[idx] || '',
                    en: sentenceTranslations[idx] || ''
                }));

                const paragraphs = paragraphList.map((de, idx) => ({
                    de,
                    gloss: paragraphGlosses[idx] || '',
                    en: paragraphTranslations[idx] || ''
                }));

                renderItems(wordsResult, words);
                renderItems(sentencesResult, sentences);
                renderItems(paragraphResult, paragraphs);

                saveCache({ input: sourceInput, words, sentences, paragraphs });

                const allGermanWords = [...wordList, ...sentenceList.join(' ').split(/\s+/), ...paragraphList.join(' ').split(/\s+/)]
                    .map((w) => w.replace(/[.,!?;:]/g, '').trim())
                    .filter(Boolean);
                addToMissed(allGermanWords);
                setStatus('Done. Matching list updated with top-list words.');
            } catch (err) {
                const message = err && err.message ? err.message.slice(0, 180) : '';
                localStorage.setItem('dt-deepl-last-error', message || 'unknown error');
                setStatus(`Translation failed. ${message}`.trim(), true);
            }
        }

        document.getElementById('translateBtn').addEventListener('click', handleTranslate);

        document.getElementById('clearBtn').addEventListener('click', () => {
            document.getElementById('sourceInput').value = '';
            wordsResult.innerHTML = '';
            sentencesResult.innerHTML = '';
            paragraphResult.innerHTML = '';
            setStatus('Cleared.');
        });

    </script>
    <script src="menu-settings.js"></script>

    <div class="settings-fab" id="settingsFab" aria-label="Open settings">
        ⚙
    </div>
    <div class="settings-panel" id="settingsPanel">
        <h4>Settings</h4>
        <div class="settings-row">
            <label for="settingsTheme" style="font-weight:600;">Theme</label>
            <select id="settingsTheme">
                <option value="system">System</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
            </select>
        </div>
        <div class="debug-box" id="deeplDebug">DeepL debug available on Translate page.</div>
        <div class="settings-actions">
            <button id="debugTestBtn">Test DeepL</button>
            <button id="debugClearBtn">Clear cache</button>
        </div>
        <div class="settings-note">Theme settings apply across all pages.</div>
    </div>

</body>
</html>
